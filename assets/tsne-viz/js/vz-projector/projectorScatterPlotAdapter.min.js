//~~WEBPATH~~/vz-projector/projectorScatterPlotAdapter.js
var Ld=d3.scaleLinear().domain([1,.7,.4]).range(["hsl(285, 80%, 40%)","hsl(0, 80%, 65%)","hsl(40, 70%, 60%)"]).clamp(!0),Qd=function(){function a(a,c){var b=this;this.scatterPlotContainer=a;this.renderLabelsIn3D=!1;this.scatterPlot=new Dd(a,c);c.registerProjectionChangedListener(function(a){b.projection=a;b.updateScatterPlotWithNewProjection(a)});c.registerSelectionChangedListener(function(a,c){b.selectedPointIndices=a;b.neighborsOfFirstSelectedPoint=c;b.updateScatterPlotPositions();b.updateScatterPlotAttributes();
b.scatterPlot.render()});c.registerHoverListener(function(a){b.hoverPointIndex=a;b.updateScatterPlotAttributes();b.scatterPlot.render()});c.registerDistanceMetricChangedListener(function(a){b.distanceMetric=a;b.updateScatterPlotAttributes();b.scatterPlot.render()});this.createVisualizers(!1)}a.prototype.notifyProjectionPositionsUpdated=function(){this.updateScatterPlotPositions();this.scatterPlot.render()};a.prototype.setDataSet=function(a){null!=this.projection&&(this.projection.dataSet=a);null!=
this.polylineVisualizer&&this.polylineVisualizer.setDataSet(a);null!=this.labels3DVisualizer&&this.labels3DVisualizer.setLabelStrings(this.generate3DLabelsArray(a,this.labelPointAccessor));if(null!=this.spriteVisualizer&&(this.spriteVisualizer.clearSpriteAtlas(),null!=a&&null!=a.spriteAndMetadataInfo)){var b=a.spriteAndMetadataInfo;if(null!=b.spriteImage&&null!=b.spriteMetadata){for(var d=a.points.length,e=new Float32Array(d),g=0;g<d;++g)e[g]=a.points[g].index;this.spriteVisualizer.setSpriteAtlas(b.spriteImage,
b.spriteMetadata.singleImageDim,e)}}};a.prototype.set3DLabelMode=function(a){this.renderLabelsIn3D=a;this.createVisualizers(a);this.updateScatterPlotAttributes();this.scatterPlot.render()};a.prototype.setLegendPointColorer=function(a){this.legendPointColorer=a};a.prototype.setLabelPointAccessor=function(a){this.labelPointAccessor=a;null!=this.labels3DVisualizer&&this.labels3DVisualizer.setLabelStrings(this.generate3DLabelsArray(null==this.projection?null:this.projection.dataSet,a))};a.prototype.resize=
function(){this.scatterPlot.resize()};a.prototype.populateBookmarkFromUI=function(a){a.cameraDef=this.scatterPlot.getCameraDef()};a.prototype.restoreUIFromBookmark=function(a){this.scatterPlot.setCameraParametersForNextCameraCreation(a.cameraDef,!1)};a.prototype.updateScatterPlotPositions=function(){var a=this.generatePointPositionArray(null==this.projection?null:this.projection.dataSet,null==this.projection?null:this.projection.projectionComponents);this.scatterPlot.setPointPositions(a)};a.prototype.updateScatterPlotAttributes=
function(){if(null!=this.projection){var a=this.projection.dataSet,c=this.selectedPointIndices,d=this.hoverPointIndex,e=this.neighborsOfFirstSelectedPoint,g=this.legendPointColorer,h=this.generatePointColorArray(a,g,this.distanceMetric,c,e,d,this.renderLabelsIn3D,this.getSpriteImageMode()),k=this.generatePointScaleFactorArray(a,c,e,d),d=this.generateVisibleLabelRenderParams(a,c,e,d),g=this.generateLineSegmentColorMap(a,g),e=this.generateLineSegmentOpacityArray(a,c),a=this.generateLineSegmentWidthArray(a,
c);this.scatterPlot.setPointColors(h);this.scatterPlot.setPointScaleFactors(k);this.scatterPlot.setLabels(d);this.scatterPlot.setPolylineColors(g);this.scatterPlot.setPolylineOpacities(e);this.scatterPlot.setPolylineWidths(a)}};a.prototype.render=function(){this.scatterPlot.render()};a.prototype.generatePointPositionArray=function(a,c){if(null==a)return null;var b=d3.scaleLinear(),e=d3.scaleLinear(),g=null,h=d3.extent(a.points,function(b,d){return a.points[d].projections[c[0]]}),k=d3.extent(a.points,
function(b,d){return a.points[d].projections[c[1]]}),l=[-1,1];b.domain(h).range(l);e.domain(k).range(l);null!=c[2]&&(h=d3.extent(a.points,function(b,d){return a.points[d].projections[c[2]]}),g=d3.scaleLinear(),g.domain(h).range(l));var m=new Float32Array(3*a.points.length),p=0;a.points.forEach(function(d,g){m[p++]=b(a.points[g].projections[c[0]]);m[p++]=e(a.points[g].projections[c[1]]);m[p++]=0});g&&(p=2,a.points.forEach(function(b,d){m[p]=g(a.points[d].projections[c[2]]);p+=3}));return m};a.prototype.generateVisibleLabelRenderParams=
function(a,c,d,e){if(null==a)return null;var b=null==c?0:c.length,h=null==d?0:d.length,k=b+h+(null!=e?1:0),l=new Uint32Array(k),m=new Float32Array(k),p=new Int8Array(k),r=new Uint8Array(3*k),k=new Uint8Array(3*k),n=[];m.fill(1);p.fill(1);var t=0;if(null!=e){n.push(this.getLabelText(a,e,this.labelPointAccessor));l[t]=e;m[t]=2;p[t]=0;var q=Md(0);Nd(r,t,q[0],q[1],q[2]);var u=Md(16777215);Nd(k,t,u[0],u[1],u[1]);++t}q=Md(0);u=Md(16777215);for(var v=0;v<b;++v)e=c[v],n.push(this.getLabelText(a,e,this.labelPointAccessor)),
l[t]=e,m[t]=2,p[t]=1===b?0:1,Nd(r,t,q[0],q[1],q[2]),Nd(k,t,u[0],u[1],u[2]),++t;q=Md(0);u=Md(16777215);for(v=0;v<h;++v)e=d[v].index,n.push(this.getLabelText(a,e,this.labelPointAccessor)),l[t]=e,Nd(r,t,q[0],q[1],q[2]),Nd(k,t,u[0],u[1],u[2]),++t;return new nc(new Float32Array(l),n,m,p,r,k)};a.prototype.generatePointScaleFactorArray=function(a,c,d,e){if(null==a)return new Float32Array(0);var b=new Float32Array(a.points.length);b.fill(1);var h=null==d?0:d.length;var k=null==c?0:c.length;for(var l=0;l<
k;++l)a=c[l],b[a]=1.2;k=h;for(l=0;l<k;++l)a=d[l].index,b[a]=1.2;null!=e&&(b[e]=1.2);return b};a.prototype.generateLineSegmentColorMap=function(a,c){var b={};if(null==a)return b;for(var e=0;e<a.sequences.length;e++){var g=a.sequences[e],h=new Float32Array(6*(g.pointIndices.length-1)),k=0;if(c)for(var l=0;l<g.pointIndices.length-1;l++){var m=new V.Color(c(a,g.pointIndices[l]));var p=new V.Color(c(a,g.pointIndices[l+1]));h[k++]=m.r;h[k++]=m.g;h[k++]=m.b;h[k++]=p.r;h[k++]=p.g;h[k++]=p.b}else for(l=0;l<
g.pointIndices.length-1;l++)m=Od(l,g.pointIndices.length),p=Od(l+1,g.pointIndices.length),h[k++]=m.r,h[k++]=m.g,h[k++]=m.b,h[k++]=p.r,h[k++]=p.g,h[k++]=p.b;b[e]=h}return b};a.prototype.generateLineSegmentOpacityArray=function(a,c){if(null==a)return new Float32Array(0);var b=new Float32Array(a.sequences.length);0<(null==c?0:c.length)?(b.fill(.05),b[a.points[c[0]].sequenceIndex]=.9):b.fill(.2);return b};a.prototype.generateLineSegmentWidthArray=function(a,c){if(null==a)return new Float32Array(0);var b=
new Float32Array(a.sequences.length);b.fill(2);0<(null==c?0:c.length)&&(b[a.points[c[0]].sequenceIndex]=3);return b};a.prototype.generatePointColorArray=function(a,c,d,e,g,h,k,l){if(null==a)return new Float32Array(0);var b=null==e?0:e.length,p=null==g?0:g.length,r=new Float32Array(3*a.points.length);var n=14935011;var t=7697881;k&&(t=n=16777215);l&&(t=n=16777215);l=a.points.length;k=0;if(0<b)for(n=new V.Color(n),t=0;t<l;++t)r[k++]=n.r,r[k++]=n.g,r[k++]=n.b;else if(null!=c)for(t=0;t<l;++t)n=new V.Color(c(a,
t)),r[k++]=n.r,r[k++]=n.g,r[k++]=n.b;else for(n=new V.Color(t),t=0;t<l;++t)r[k++]=n.r,r[k++]=n.g,r[k++]=n.b;l=b;n=new V.Color(16410214);for(t=0;t<l;++t)k=3*e[t],r[k++]=n.r,r[k++]=n.g,r[k++]=n.b;l=p;a=0<l?g[0].dist:0;for(t=0;t<l;++t)n=new V.Color(Ld(Pd(d,g[t].dist,a))),k=3*g[t].index,r[k++]=n.r,r[k++]=n.g,r[k++]=n.b;null!=h&&(n=new V.Color(7736143),k=3*h,r[k++]=n.r,r[k++]=n.g,r[k++]=n.b);return r};a.prototype.generate3DLabelsArray=function(a,c){if(null==a||null==c)return null;for(var b=[],e=a.points.length,
g=0;g<e;++g)b.push(this.getLabelText(a,g,c));return b};a.prototype.getLabelText=function(a,c,d){return a.points[c].metadata[d].toString()};a.prototype.updateScatterPlotWithNewProjection=function(a){null==a?(this.createVisualizers(this.renderLabelsIn3D),this.scatterPlot.render()):(this.setDataSet(a.dataSet),this.scatterPlot.setDimensions(a.dimensionality),a.dataSet.projectionCanBeRendered(a.projectionType)&&(this.updateScatterPlotAttributes(),this.notifyProjectionPositionsUpdated()),this.scatterPlot.setCameraParametersForNextCameraCreation(null,
!1))};a.prototype.createVisualizers=function(a){var b=null==this.projection?null:this.projection.dataSet,d=this.scatterPlot;d.removeAllVisualizers();this.polylineVisualizer=this.spriteVisualizer=this.canvasLabelsVisualizer=this.labels3DVisualizer=null;a?(this.labels3DVisualizer=new Fd,this.labels3DVisualizer.setLabelStrings(this.generate3DLabelsArray(b,this.labelPointAccessor))):(this.spriteVisualizer=new Kd,d.addVisualizer(this.spriteVisualizer),this.canvasLabelsVisualizer=new Gd(this.scatterPlotContainer));
this.polylineVisualizer=new Hd;this.setDataSet(b);this.spriteVisualizer&&d.addVisualizer(this.spriteVisualizer);this.labels3DVisualizer&&d.addVisualizer(this.labels3DVisualizer);this.canvasLabelsVisualizer&&d.addVisualizer(this.canvasLabelsVisualizer);d.addVisualizer(this.polylineVisualizer)};a.prototype.getSpriteImageMode=function(){if(null==this.projection)return!1;var a=this.projection.dataSet;return null==a||null==a.spriteAndMetadataInfo?!1:null!=a.spriteAndMetadataInfo.spriteImage};return a}();
function Nd(a,b,c,d,e){a[3*b]=c;a[3*b+1]=d;a[3*b+2]=e}function Md(a){a=new V.Color(a);return[255*a.r|0,255*a.g|0,255*a.b|0]}function Od(a,b){a=d3.hsl(60+300*a/b,1,.3).rgb();return new V.Color(a.r/255,a.g/255,a.b/255)}function Pd(a,b,c){return a===Mc?c/b:1-b};