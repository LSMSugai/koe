//~~WEBPATH~~/vz-projector/scatterPlot.js
var wd=new V.Vector3(.45,.9,1.6),xd=new V.Vector3(0,0,0),yd=new V.Vector3(0,0,4),zd=new V.Vector3(0,0,0),Ad,Bd=Ad||(Ad={});Bd[Bd.AREA_SELECT=0]="AREA_SELECT";Bd[Bd.CAMERA_AND_CLICK_SELECT=1]="CAMERA_AND_CLICK_SELECT";function Cd(){this.orthographic=!1}
var Dd=function(){function a(a,c){var b=this;this.container=a;this.projectorEventContext=c;this.visualizers=[];this.onCameraMoveListeners=[];this.backgroundColor=16777215;this.dimensionality=3;this.cameraDef=null;this.isDragSequence=this.mouseIsDown=this.selecting=this.orbitAnimationOnNextCameraCreation=!1;this.getLayoutValues();this.scene=new V.Scene;this.renderer=new V.WebGLRenderer({alpha:!0,premultipliedAlpha:!1,antialias:!1});this.renderer.setClearColor(16777215,1);this.container.appendChild(this.renderer.domElement);
this.light=new V.PointLight(16772287,1,0);this.scene.add(this.light);this.setDimensions(3);this.recreateCamera(this.makeDefaultCameraDef(this.dimensionality));this.renderer.render(this.scene,this.camera);this.rectangleSelector=new wc(this.container,function(a){return b.selectBoundingBox(a)});this.addInteractionListeners()}a.prototype.addInteractionListeners=function(){this.container.addEventListener("mousemove",this.onMouseMove.bind(this));this.container.addEventListener("mousedown",this.onMouseDown.bind(this));
this.container.addEventListener("mouseup",this.onMouseUp.bind(this));this.container.addEventListener("click",this.onClick.bind(this));window.addEventListener("keydown",this.onKeyDown.bind(this),!1);window.addEventListener("keyup",this.onKeyUp.bind(this),!1)};a.prototype.addCameraControlsEventListeners=function(a){var b=this;a.addEventListener("start",function(){b.stopOrbitAnimation();b.onCameraMoveListeners.forEach(function(c){return c(b.camera.position,a.target)})});a.addEventListener("change",function(){b.render()});
a.addEventListener("end",function(){})};a.prototype.makeOrbitControls=function(a,c,d){null!=this.orbitCameraControls&&this.orbitCameraControls.dispose();var b=new V.OrbitControls(a,this.renderer.domElement);b.target0=new V.Vector3(c.target[0],c.target[1],c.target[2]);b.position0=(new V.Vector3).copy(a.position);b.zoom0=c.zoom;b.enableRotate=d;b.autoRotate=!1;b.rotateSpeed=1;d?(b.mouseButtons.ORBIT=V.MOUSE.LEFT,b.mouseButtons.PAN=V.MOUSE.RIGHT):(b.mouseButtons.ORBIT=null,b.mouseButtons.PAN=V.MOUSE.LEFT);
b.reset();this.camera=a;this.orbitCameraControls=b;this.addCameraControlsEventListeners(this.orbitCameraControls)};a.prototype.makeCamera3D=function(a,c,d){c=new V.PerspectiveCamera(70,c/d,.01,100);c.position.set(a.position[0],a.position[1],a.position[2]);c.lookAt(new V.Vector3(a.target[0],a.target[1],a.target[2]));c.zoom=a.zoom;c.updateProjectionMatrix();this.camera=c;this.makeOrbitControls(c,a,!0)};a.prototype.makeCamera2D=function(a,c,d){var b=new V.Vector3(a.target[0],a.target[1],a.target[2]);
c/=d;d=-1.2;var g=1.2,h=-1.2,k=1.2;1<c?(d*=c,g*=c):(k/=c,h/=c);c=new V.OrthographicCamera(d,g,k,h,-1E3,1E3);c.position.set(a.position[0],a.position[1],a.position[2]);c.up=new V.Vector3(0,1,0);c.lookAt(b);c.zoom=a.zoom;c.updateProjectionMatrix();this.camera=c;this.makeOrbitControls(c,a,!1)};a.prototype.makeDefaultCameraDef=function(a){var b=new Cd;b.orthographic=2===a;b.zoom=1;b.orthographic?(b.position=[yd.x,yd.y,yd.z],b.target=[zd.x,zd.y,zd.z]):(b.position=[wd.x,wd.y,wd.z],b.target=[xd.x,xd.y,xd.z]);
return b};a.prototype.recreateCamera=function(a){a.orthographic?this.makeCamera2D(a,this.width,this.height):this.makeCamera3D(a,this.width,this.height);this.orbitCameraControls.minDistance=.05;this.orbitCameraControls.maxDistance=10;this.orbitCameraControls.update();this.orbitAnimationOnNextCameraCreation&&this.startOrbitAnimation()};a.prototype.onClick=function(a,c){void 0===c&&(c=!0);a&&this.selecting||(!this.isDragSequence&&c&&this.projectorEventContext.notifySelectionChanged(null!=this.nearestPoint?
[this.nearestPoint]:[]),this.isDragSequence=!1,this.render())};a.prototype.onMouseDown=function(a){this.isDragSequence=!1;this.mouseIsDown=!0;this.selecting?(this.orbitCameraControls.enabled=!1,this.rectangleSelector.onMouseDown(a.offsetX,a.offsetY),this.setNearestPointToMouse(a)):!a.ctrlKey&&this.sceneIs3D()&&this.orbitCameraControls.mouseButtons.ORBIT===V.MOUSE.RIGHT?(this.orbitCameraControls.mouseButtons.ORBIT=V.MOUSE.LEFT,this.orbitCameraControls.mouseButtons.PAN=V.MOUSE.RIGHT):a.ctrlKey&&this.sceneIs3D()&&
this.orbitCameraControls.mouseButtons.ORBIT===V.MOUSE.LEFT&&(this.orbitCameraControls.mouseButtons.ORBIT=V.MOUSE.RIGHT,this.orbitCameraControls.mouseButtons.PAN=V.MOUSE.LEFT)};a.prototype.onMouseUp=function(){this.selecting&&(this.orbitCameraControls.enabled=!0,this.rectangleSelector.onMouseUp(),this.render());this.mouseIsDown=!1};a.prototype.onMouseMove=function(a){this.isDragSequence=this.mouseIsDown;this.selecting&&this.mouseIsDown?(this.rectangleSelector.onMouseMove(a.offsetX,a.offsetY),this.render()):
this.mouseIsDown||(this.setNearestPointToMouse(a),this.projectorEventContext.notifyHoverOverPoint(this.nearestPoint))};a.prototype.onKeyDown=function(a){17===a.keyCode&&this.sceneIs3D()&&(this.orbitCameraControls.mouseButtons.ORBIT=V.MOUSE.RIGHT,this.orbitCameraControls.mouseButtons.PAN=V.MOUSE.LEFT);16===a.keyCode&&(this.selecting=!0,this.container.style.cursor="crosshair")};a.prototype.onKeyUp=function(a){17===a.keyCode&&this.sceneIs3D()&&(this.orbitCameraControls.mouseButtons.ORBIT=V.MOUSE.LEFT,
this.orbitCameraControls.mouseButtons.PAN=V.MOUSE.RIGHT);16===a.keyCode&&(this.selecting=this.getMouseMode()===Ad.AREA_SELECT,this.selecting||(this.container.style.cursor="default"),this.render())};a.prototype.getPointIndicesFromPickingTexture=function(a){if(null==this.worldSpacePointPositions)return null;var b=this.worldSpacePointPositions.length/3,d=window.devicePixelRatio||1,e=Math.floor(a.width*d),g=Math.floor(a.height*d),h=new Uint8Array(e*g*4);this.renderer.readRenderTargetPixels(this.pickingTexture,
Math.floor(a.x*d),this.pickingTexture.height-Math.floor(a.y*d),e,g,h);a=new Uint8Array(this.worldSpacePointPositions.length);for(d=0;d<e*g;d++){var k=h[4*d]<<16|h[4*d+1]<<8|h[4*d+2];16777215!==k&&k<b&&(a[k]=1)}b=[];for(d=0;d<a.length;d++)1===a[d]&&b.push(d);return b};a.prototype.selectBoundingBox=function(a){a=this.getPointIndicesFromPickingTexture(a);this.projectorEventContext.notifySelectionChanged(a)};a.prototype.setNearestPointToMouse=function(a){null==this.pickingTexture?this.nearestPoint=null:
(a=this.getPointIndicesFromPickingTexture({x:a.offsetX,y:a.offsetY,width:1,height:1}),this.nearestPoint=null!=a?a[0]:null)};a.prototype.getLayoutValues=function(){this.width=this.container.offsetWidth;this.height=Math.max(1,this.container.offsetHeight);return[this.width,this.height]};a.prototype.sceneIs3D=function(){return 3===this.dimensionality};a.prototype.remove3dAxisFromScene=function(){var a=this.scene.getObjectByName("axes");null!=a&&this.scene.remove(a);return a};a.prototype.add3dAxis=function(){var a=
new V.AxisHelper;a.name="axes";this.scene.add(a)};a.prototype.setDimensions=function(a){if(2!==a&&3!==a)throw new RangeError("dimensionality must be 2 or 3");this.dimensionality=a;var b=this.cameraDef||this.makeDefaultCameraDef(a);this.recreateCamera(b);this.remove3dAxisFromScene();3===a&&this.add3dAxis()};a.prototype.getCameraDef=function(){var a=new Cd,c=this.camera.position,d=this.orbitCameraControls.target;a.orthographic=!this.sceneIs3D();a.position=[c.x,c.y,c.z];a.target=[d.x,d.y,d.z];a.zoom=
this.camera.zoom;return a};a.prototype.setCameraParametersForNextCameraCreation=function(a,c){this.cameraDef=a;this.orbitAnimationOnNextCameraCreation=c};a.prototype.getCameraPosition=function(){var a=this.camera.position;return[a.x,a.y,a.z]};a.prototype.getCameraTarget=function(){var a=this.orbitCameraControls.target;return[a.x,a.y,a.z]};a.prototype.setCameraPositionAndTarget=function(a,c){this.stopOrbitAnimation();this.camera.position.set(a[0],a[1],a[2]);this.orbitCameraControls.target.set(c[0],
c[1],c[2]);this.orbitCameraControls.update();this.render()};a.prototype.startOrbitAnimation=function(){this.sceneIs3D()&&(null!=this.orbitAnimationId&&this.stopOrbitAnimation(),this.orbitCameraControls.autoRotate=!0,this.orbitCameraControls.rotateSpeed=7,this.updateOrbitAnimation())};a.prototype.updateOrbitAnimation=function(){var a=this;this.orbitCameraControls.update();this.orbitAnimationId=requestAnimationFrame(function(){return a.updateOrbitAnimation()})};a.prototype.stopOrbitAnimation=function(){this.orbitCameraControls.autoRotate=
!1;this.orbitCameraControls.rotateSpeed=1;null!=this.orbitAnimationId&&(cancelAnimationFrame(this.orbitAnimationId),this.orbitAnimationId=null)};a.prototype.addVisualizer=function(a){this.scene&&a.setScene(this.scene);a.onResize(this.width,this.height);a.onPointPositionsChanged(this.worldSpacePointPositions);this.visualizers.push(a)};a.prototype.removeAllVisualizers=function(){this.visualizers.forEach(function(a){return a.dispose()});this.visualizers=[]};a.prototype.setPointPositions=function(a){this.worldSpacePointPositions=
a;this.visualizers.forEach(function(b){return b.onPointPositionsChanged(a)})};a.prototype.render=function(){var a=this.camera.position.clone();a.x+=1;a.y+=1;this.light.position.set(a.x,a.y,a.z);var a=this.camera instanceof V.PerspectiveCamera?vc.Perspective:vc.Orthographic,c=[0,0];null!=this.worldSpacePointPositions&&(c=Bc(this.worldSpacePointPositions,this.camera.position,this.orbitCameraControls.target));var d=new uc(this.camera,a,this.orbitCameraControls.target,this.width,this.height,c[0],c[1],
this.backgroundColor,this.pointColors,this.pointScaleFactors,this.labels,this.polylineColors,this.polylineOpacities,this.polylineWidths);this.visualizers.forEach(function(a){return a.onPickingRender(d)});a=this.remove3dAxisFromScene();this.renderer.render(this.scene,this.camera,this.pickingTexture);null!=a&&this.scene.add(a);this.visualizers.forEach(function(a){return a.onRender(d)});this.renderer.render(this.scene,this.camera)};a.prototype.setMouseMode=function(a){this.mouseMode=a;a===Ad.AREA_SELECT?
(this.selecting=!0,this.container.style.cursor="crosshair"):(this.selecting=!1,this.container.style.cursor="default")};a.prototype.setPointColors=function(a){this.pointColors=a};a.prototype.setPointScaleFactors=function(a){this.pointScaleFactors=a};a.prototype.setLabels=function(a){this.labels=a};a.prototype.setPolylineColors=function(a){this.polylineColors=a};a.prototype.setPolylineOpacities=function(a){this.polylineOpacities=a};a.prototype.setPolylineWidths=function(a){this.polylineWidths=a};a.prototype.getMouseMode=
function(){return this.mouseMode};a.prototype.resetZoom=function(){this.recreateCamera(this.makeDefaultCameraDef(this.dimensionality));this.render()};a.prototype.setDayNightMode=function(a){var b=this.container.querySelectorAll("canvas");a=a?"invert(100%)":null;for(var d=0;d<b.length;d++)b[d].style.filter=a};a.prototype.resize=function(a){void 0===a&&(a=!0);var b=[this.width,this.height];var d=b[0],e=b[1];b=this.getLayoutValues();var g=b[0],h=b[1];3===this.dimensionality?(b=this.camera,b.aspect=g/
h):(b=this.camera,d=g/d*(b.right-b.left)/2,e=h/e*(b.top-b.bottom)/2,b.top=e,b.bottom=-e,b.left=-d,b.right=d);b.updateProjectionMatrix();this.renderer.setPixelRatio();this.renderer.setSize(g,h);b=this.renderer.getSize();d=this.renderer.getPixelRatio();this.pickingTexture=new V.WebGLRenderTarget(b.width*d,b.height*d);this.pickingTexture.texture.minFilter=V.LinearFilter;this.visualizers.forEach(function(a){return a.onResize(g,h)});a&&this.render()};a.prototype.onCameraMove=function(a){this.onCameraMoveListeners.push(a)};
a.prototype.clickOnPoint=function(a){this.nearestPoint=a;this.onClick(null,!1)};return a}(),Ed=Ad;