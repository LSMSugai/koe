{% load render_bundle from webpack_loader %}
{% load static %}
{% load custom_tags %}

<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>{% block title %}{% endblock %}</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Webpack rendered CSS -->
    {% render_bundle 'main' 'css' %}
    <style>
        #loading-spinner-modal {
            background: rgba(255, 255, 255, .8) url('{% static "images/loading-fading-squares.gif" %}') 50% 50% no-repeat;
        }
    </style>
</head>

<body>

<div class="vh-offset" id="content-wrapper">
    <iframe id="my_iframe" style="display:none;"></iframe>

    {# The navbar is supposed to be always on top#}
    <div id="navbar">
        <span class="navbar-brand" href="#">
            鳥声 KOE |
            {% get_navbar_urls as urls %}
            {% for url, text in urls.items %}
                {% if page == url %}
                    <span href="{% url url %}" class="navbar-link active">{{ text }}</span>
                {% else %}
                    <a href="{% url url %}" class="navbar-link">{{ text }}</a>
                {% endif %}
            {% endfor %}

        </span>

        {% block navbar-right %}
            {% if user.is_authenticated %}
                <p class="navbar-text">Hi {{ user.username }}
                    <a href="{% url 'logout' %}" class="navbar-link">Log out</a>
                    <a href="#" id="download-data-btn" class="navbar-link">Backup this version</a>
                </p>
            {% endif %}
        {% endblock %}
    </div>

    <div class="main-content">
        <div class="content-center">
            {% block content-center %}{% endblock %}
        </div>
    </div>

    <div class="alert alert-success">a</div>
    <div class="alert alert-danger">b</div>
    <div class="alert alert-warning">c</div>

</div>
<div class="offset-holder" id="content-wrapper-offset-holder" attr="height"></div>
<div id="max-vh"></div>

<div class="modal" id="loading-spinner-modal"></div>

{% render_bundle 'main' 'js' 'JQUERY' %}
<!-- django-js-reverse -->
<script src="{% url 'js_reverse' %}" type="text/javascript"></script>

<!-- Webpack rendered Javascript -->
{% render_bundle 'main' 'js' %}

<!-- Common URL -->
<script>
    window.appCache = {};
    {% get_server_constants as constants %}

    var constants = {{ constants|safe }};
    for (var key in constants) {
        if (constants.hasOwnProperty(key)) {
            window.appCache[key] = Object.freeze(constants[key]);
        }
    }

</script>

{% block scripts %}{% endblock %}
</body>
</html>
